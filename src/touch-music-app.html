<link rel="import" href="../bower_components/polymer/polymer.html">
<!--<link rel="import" href="game-master.html">-->
<link rel="import" href="songs-set.html">
<link rel="import" href="keyboard-map.html">
<link rel="import" href="keyboard-listener.html">
<link rel="import" href="key-node.html">
<link rel="import" href="event-player.html">
<link rel="import" href="timer-ticker.html">
<link rel="import" href="synthesizer-player.html">
<link rel="import" href="music-instrument.html">
<link rel="import" href="octave-filter.html">

<dom-module id="touch-music-app">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>

        <synthesizer-player id="synthesizer">
            <music-instrument name="piano" base="../assets/piano/"></music-instrument>
        </synthesizer-player>


        <div id="button" on-tap="start">Start annoying song</div>
        <div id="button2" on-tap="startTicker">Start ticker</div>

        <timer-ticker id="ticker" ms-per-tick="[[tempo]]" ticks="{{ticks}}"></timer-ticker>

		<octave-filter on-play="debug" octave="{{jsonSong.globals.octave}}">
			<event-player id="musicSheeter" ticks-per-turn=50
						log="{{thisIsWhatWeNeedToMatchTheUsersPerformanceAgainst}}" ticks="[[ticks]]"
						input="[[songAsEvents]]" on-ready="musicPlayerReady">
				<songs-set id="libs" song-name="oldMacDonald" curr-song="{{jsonSong}}"></songs-set>
				<event-list-parser id="eParser" input="{{jsonSong.events}}" output="{{songAsEvents}}"></event-list-parser>
			</event-player>
		</octave-filter>
        <!--<game-master id="master" ></game-master>-->

		<!--<iron-ajax url="myKeySet.json" data-json="[[keyMap]]"></iron-ajax>-->
		<keyboard-map>
			<template is="dom-repeat" items="[[keysArray]]">
				<key-node letter$="[[item]]">
				<!--<key-mole></key-mole>-->
				<!--<key-hammer></key-hammer>-->
				</key-node>
			</template>
		</keyboard-map>

		<keyboard-listener on-key-event="keyIsHit" key-set="[[keysArray]]" last-pressed="{{lastKey}}"></keyboard-listener>

	</template>

	<script>
		Polymer({
			is: 'touch-music-app',
			properties: {
				keysArray: {
					type: Array,
					value: function() {
						return [
							"`", "1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "-", "=", "backspace",
							"tab", "q", "w", "e", "r", "t", "y", "u", "i", "o", "p", "[", "]", "\\",
							"capslock", "a", "s", "d", "f", "g", "h", "j", "k", "l", ";", "'", "enter",
							"shiftL", "z", "x", "c", "v", "b", "n", "m", ",", ".", "/", "shiftR",
							"ctrlL", "altL", "space", "altR", "ctrlR"
						]
					}
				},
				// tempo: {
				// 	type: Number,
				// 	value: 20
				// },
				songAsEvents: {
					type: Array,
				}
			},
			debug: function(e){
			    var note = e.detail[1].name.toUpperCase();
			    this.$.synthesizer.playTone(note);
			},
			musicPlayerReady: function(){
				this.start();
			},
            start: function() {
            },
            startTicker: function() {
                this.$.ticker.toggle();
            }
		});
	</script>
</dom-module>